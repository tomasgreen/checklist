(function(){"use strict";function t(t,e,n){function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var o=i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i();e(t,o,n)}function e(t){return t.replace(/(<([^>]+)>)/gi,"").replace(/\s/gi,"").replace(/&nbsp;/gi,"")}function n(t,e){return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}function i(t,e,n,i){var o,s;e||(e={}),-1!==t.indexOf(".")&&(s=t.split("."),t=s[0],s.shift(),e["class"]=s.join(" ")),-1!==t.indexOf("#")&&(s=t.split("#"),t=s[0],e.id=s[1]),o=document.createElement(t);for(var r in e)o.setAttribute(r,e[r]);return n&&n.appendChild(o),i&&(o.innerHTML=i),o}function o(t){return t&&t.parentNode?void t.parentNode.removeChild(t):void 0}function s(t){"function"==typeof t.stopPropagation?(t.stopPropagation(),t.preventDefault()):window.event&&window.event.hasOwnProperty("cancelBubble")&&(window.event.cancelBubble=!0)}function r(t,e){if(!k)return void d(t,"click",e);var n=!1;d(t,"touchstart",function(t){n=!0}),d(t,"touchend",function(t){n&&(e(t),s(t))}),d(t,"touchcancel touchleave touchmove",function(t){n=!1})}function l(t,e){!t||0===t.length&&t!=window||(t.length?Array.prototype.forEach.call(t,function(t,n){e(t)}):e(t))}function c(t,e,n,i){d(t,e,function(i){n(i),a(t,e,n)},i)}function d(t,e,n,i){l(t,function(t){var o=e.split(" ");for(var s in o)t.addEventListener(o[s],n,i)})}function a(t,e,n){l(t,function(t){var i=e.split(" ");for(var o in i)t.removeEventListener(i[o],n)})}function u(t,e,n){l(t,function(t){t.setAttribute(e,n)})}function h(t){void 0===t&&(t={});var e={};for(var n in g)e[n]=void 0!==t[n]?t[n]:g[n];return e}function p(t,e){l(t,function(t){if(t.classList){var n=e.split(" ");for(var i in n)t.classList.add(n[i])}else t.className+=" "+e})}function f(t,e){l(t,function(t){if(t.classList){var n=e.split(" ");for(var i in n)t.classList.remove(n[i])}else t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")})}function v(t,e,n,i){n&&c(t,b,n),c(t,b,function(n){f(t,e),i&&i(n)}),p(t,e)}function y(t,e){return t&&e?E(t,e)?t:y(t.parentNode,e):null}function E(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}function x(t){var e=t.querySelector(".todo-text");return{todo_id:t.getAttribute("todo-id"),done:"true"===t.getAttribute("done"),text:e.innerHTML}}var b="webkitAnimationEnd mozAnimationEnd msAnimationEnd oAnimationEnd animationend",k="ontouchstart"in document.documentElement,g={iconChecked:'<span class="fa fa-check-square-o"></span>',iconUnchecked:'<span class="fa fa-square-o"></span>',iconDelete:'<span class="fa fa-trash-o"></span>',iconInput:'<span class="fa fa-chevron-right"></span>',onDelete:null,onInsert:null,onDone:null,onUpdate:null,showDeleteButton:!1,placeholder:"Write here and press enter",guidFunction:t},m=function(t,e,n){if(this.container=t,this.opt=h(n),this.insertEl=i("div.todo-insert",null,this.container),i("div.todo-input-icon",null,this.insertEl,this.opt.iconInput),this.insertTextEl=i("div.todo-text",{contenteditable:!0,spellcheck:!1,placeholder:this.opt.placeholder},this.insertEl),this.listEl=i("div.todo-list",null,this.container),e)for(var o in e)this.insertWithId(e[o],null,!1);d(this.insertTextEl,"keydown",this.insertKeydownEvent.bind(this)),d(this.insertTextEl,"blur",this.insertBlurEvent.bind(this))};m.prototype.insert=function(t){void 0===t.todo_id?this.opt.guidFunction(t,this.insertWithId.bind(this),!0):this.insertWithId(t,null,!0)},m.prototype.insertWithId=function(t,e,n){e&&(t.todo_id=e);var o=i("div.todo",{done:t.done,"todo-id":t.todo_id,"data-original-text":t.text}),s=i("div.todo-checker",null,o,t.done?this.opt.iconChecked:this.opt.iconUnchecked),l=i("div.todo-text",{contenteditable:!0,spellcheck:!1},o,t.text);if(this.opt.showDeleteButton){var c=i("div.todo-delete",null,o,this.opt.iconDelete);r(c,this.deleteEvent.bind(this))}r(s,this.checkEvent.bind(this)),d(l,"blur",this.updateEvent.bind(this)),d(l,"keydown",this.todoKeydownEvent.bind(this)),this.listEl.insertBefore(o,this.listEl.firstChild),n&&(this.opt.onInsert&&this.opt.onInsert(o,t),v(o,"checklist-flipInX"))},m.prototype["delete"]=function(t){var e=this.listEl.querySelector('[todo-id="'+t.todo_id+'"]');if(e){var n=this;v(e,"checklist-flipOutX",null,function(i){e.nextSibling?e.nextSibling.querySelector(".todo-text").focus():e.previousSibling?e.previousSibling.querySelector(".todo-text").focus():n.insertTextEl.focus(),o(e),n.opt.onDelete&&n.opt.onDelete(e,t)})}},m.prototype.update=function(t){var e=this.listEl.querySelector('[todo-id="'+t.todo_id+'"]');if(e){var n=e.querySelector(".todo-checker");u(e,"done",t.done),u(e,"data-original-text",t.text),e.querySelector(".todo-text").innerHTML=t.text,n.innerHTML=t.done?this.opt.iconChecked:this.opt.iconUnchecked,v(e,"checklist-pulse")}},m.prototype.todoKeydownEvent=function(t){var e=y(t.srcElement,"todo"),n=x(e);t.shiftKey||13!=t.keyCode?t.metaKey&&8==t.keyCode||46==t.keyCode&&t.shiftKey?(this["delete"](n),s(t)):t.altKey&&38==t.keyCode?(e.previousSibling?e.previousSibling.querySelector(".todo-text").focus():this.insertTextEl.focus(),s(t)):t.altKey&&40==t.keyCode&&(e.nextSibling&&e.nextSibling.querySelector(".todo-text").focus(),s(t)):(n.done=!n.done,this.update(n),s(t))},m.prototype.insertBlurEvent=function(t){var n=e(this.insertTextEl.innerHTML);(""===n||null===n)&&(this.insertTextEl.innerHTML="")},m.prototype.insertKeydownEvent=function(t){var n=this.insertTextEl.innerHTML;if(t.shiftKey||13!=t.keyCode||""===e(n))t.altKey&&40==t.keyCode&&(this.listEl.firstChild&&this.listEl.firstChild.querySelector(".todo-text").focus(),s(t));else{var i={text:n,done:!1};this.insert(i),this.insertTextEl.innerHTML="",s(t)}},m.prototype.checkEvent=function(t){var e=y(t.srcElement,"todo"),n=e.querySelector(".todo-checker"),i=x(e);i.done=!i.done,n.innerHTML=i.done?this.opt.iconChecked:this.opt.iconUnchecked,u(e,"done",i.done),this.opt.onUpdate&&this.opt.onUpdate(e,i),v(e,"checklist-pulse")},m.prototype.updateEvent=function(t){var e=y(t.srcElement,"todo"),n=x(e);e.getAttribute("data-original-text")!=n.text&&(u(e,"data-original-text",n.text),this.opt.onUpdate&&this.opt.onUpdate(e,n),v(e,"checklist-pulse"))},m.prototype.deleteEvent=function(t){var e=y(t.srcElement,"todo"),n=x(e),i=this;v(e,"checklist-flipOutX",null,function(t){i.opt.onDelete&&i.opt.onDelete(e,n),o(e)}),s(t)};var w=n(m,function(t,e,n){m.call(this,t,e,n)});this.Checklist=function(t,e,n){var i=new w(t,e,n);return i},this.Checklist.globals=g}).call(this);