(function(){"use strict";function t(t,n){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var o=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e();n(t,o)}function n(t){return t.replace(" ").replace(/(<([^>]+)>)/gi,"")}function o(t,n){return n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n}function i(t,n,e,o){var i,s;n||(n={}),-1!==t.indexOf(".")&&(s=t.split("."),t=s[0],s.shift(),n["class"]=s.join(" ")),-1!==t.indexOf("#")&&(s=t.split("#"),t=s[0],n.id=s[1]),i=document.createElement(t);for(var r in n)i.setAttribute(r,n[r]);return e&&e.appendChild(i),o&&(i.innerHTML=o),i}function s(t){return t&&t.parentNode?void t.parentNode.removeChild(t):void 0}function r(t){"function"==typeof t.stopPropagation?(t.stopPropagation(),t.preventDefault()):window.event&&window.event.hasOwnProperty("cancelBubble")&&(window.event.cancelBubble=!0)}function c(t,n){if(!g)return void a(t,"click",n);var e=!1;a(t,"touchstart",function(t){e=!0}),a(t,"touchend",function(t){e&&(n(t),r(t))}),a(t,"touchcancel touchleave touchmove",function(t){e=!1})}function l(t,n){!t||0===t.length&&t!=window||(t.length?Array.prototype.forEach.call(t,function(t,e){n(t)}):n(t))}function d(t,n,e,o){a(t,n,function(o){e(o),u(t,n,e)},o)}function a(t,n,e,o){l(t,function(t){var i=n.split(" ");for(var s in i)t.addEventListener(i[s],e,o)})}function u(t,n,e){l(t,function(t){var o=n.split(" ");for(var i in o)t.removeEventListener(o[i],e)})}function h(t,n,e){l(t,function(t){t.setAttribute(n,e)})}function p(t){void 0===t&&(t={});var n={};for(var e in x)n[e]=void 0!==t[e]?t[e]:x[e];return n}function f(t,n){l(t,function(t){if(t.classList){var e=n.split(" ");for(var o in e)t.classList.add(e[o])}else t.className+=" "+n})}function v(t,n){l(t,function(t){if(t.classList){var e=n.split(" ");for(var o in e)t.classList.remove(e[o])}else t.className=t.className.replace(new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi")," ")})}function E(t,n,e,o){e&&d(t,b,e),d(t,b,function(e){v(t,n),o&&o(e)}),f(t,n)}function k(t,n){return t&&n?m(t,n)?t:k(t.parentNode,n):null}function m(t,n){return t.classList?t.classList.contains(n):new RegExp("(^| )"+n+"( |$)","gi").test(t.className)}function y(t){var n=t.querySelector(".todo-text");return{todo_id:t.getAttribute("todo-id"),done:"true"===t.getAttribute("done"),text:n.innerHTML}}var b="webkitAnimationEnd mozAnimationEnd msAnimationEnd oAnimationEnd animationend",g="ontouchstart"in document.documentElement,x={iconChecked:'<span class="fa fa-check-square-o"></span>',iconUnchecked:'<span class="fa fa-square-o"></span>',iconDelete:'<span class="fa fa-trash-o"></span>',iconAdd:'<span class="fa fa-plus"></span>',onDelete:null,onInsert:null,onDone:null,onUpdate:null,placeholder:"Write here",guidFunction:t},L=function(t,n,e){if(this.container=t,this.opt=p(e),this.insertEl=i("div.todo-insert",null,this.container),this.insertTextEl=i("div.todo-text",{contenteditable:!0,placeholder:this.opt.placeholder},this.insertEl),this.listEl=i("div.todo-list",null,this.container),n)for(var o in n)this.insert(n[o]);a(this.insertTextEl,"keydown",this.insertEvent.bind(this))};L.prototype.insert=function(t){void 0===t.todo_id?this.opt.guidFunction(t,this.insertWithId.bind(this)):this.insertWithId()},L.prototype.insertWithId=function(t,n){n&&(t.todo_id=n);var e=i("div.todo",{done:t.done,"todo-id":t.todo_id}),o=i("div.todo-checker",null,e,t.done?this.opt.iconChecked:this.opt.iconUnchecked),s=i("div.todo-text",{contenteditable:!0},e,t.text),r=i("div.todo-delete",null,e,this.opt.iconDelete);c(o,this.checkEvent.bind(this)),c(r,this.deleteEvent.bind(this)),a(s,"blur",this.updateEvent.bind(this)),this.listEl.insertBefore(e,this.listEl.firstChild),this.opt.onInsert&&this.opt.onInsert(e,t),E(e,"checklist-flipInX")},L.prototype["delete"]=function(t){var n=this.listEl.querySelector('[todo-id="'+t.todo_id+'"]');n&&E(n,"checklist-flipOutX",null,function(e){s(n),this.opt.onDelete&&this.opt.onDelete(n,t)})},L.prototype.update=function(t){var n=this.listEl.querySelector('[todo-id="'+t.todo_id+'"]');if(n){var o=e.querySelector(".todo-checker");h(n,"done",t.done),n.innerHTML=t.text,o.innerHTML=t.done?this.opt.iconChecked:this.opt.iconUnchecked,E(n,"checklist-pulse")}},L.prototype.insertEvent=function(t){var e=this.insertTextEl.innerHTML;if(!t.shiftKey&&13==t.keyCode&&""!==n(e)){var o={text:e,done:!1};this.insert(o),this.insertTextEl.innerHTML="",r(t)}},L.prototype.checkEvent=function(t){var n=k(t.srcElement,"todo"),e=n.querySelector(".todo-checker"),o=y(n);o.done=!o.done,e.innerHTML=o.done?this.opt.iconChecked:this.opt.iconUnchecked,h(n,"done",o.done),this.opt.onUpdate&&this.opt.onUpdate(n,o)},L.prototype.updateEvent=function(t){var n=k(t.srcElement,"todo"),e=y(n);this.opt.onUpdate&&this.opt.onUpdate(n,e),E(n,"checklist-pulse")},L.prototype.deleteEvent=function(t){console.log(t);var n=k(t.srcElement,"todo"),e=y(n),o=this;E(n,"checklist-flipOutX",null,function(t){o.opt.onDelete&&o.opt.onDelete(n,e),s(n)}),r(t)};var w=o(L,function(t,n,e){L.call(this,t,n,e)});this.Checklist=function(t,n,e){var o=new w(t,n,e);return o},this.Checklist.globals=x}).call(this);