(function(){"use strict";function t(t,e,n){function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var o=i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i();e(t,o,n)}function e(t){return t.replace(/(<([^>]+)>)/gi,"").replace(/\s/gi,"").replace(/&nbsp;/gi,"")}function n(t,e){return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}function i(t,e,n,i){var o,r;e||(e={}),-1!==t.indexOf(".")&&(r=t.split("."),t=r[0],r.shift(),e["class"]=r.join(" ")),-1!==t.indexOf("#")&&(r=t.split("#"),t=r[0],e.id=r[1]),o=document.createElement(t);for(var s in e)o.setAttribute(s,e[s]);return n&&n.appendChild(o),i&&(o.innerHTML=i),o}function o(t){return t&&t.parentNode?void t.parentNode.removeChild(t):void 0}function r(t){"function"==typeof t.stopPropagation?(t.stopPropagation(),t.preventDefault()):window.event&&window.event.hasOwnProperty("cancelBubble")&&(window.event.cancelBubble=!0)}function s(t,e){if(!S)return void d(t,"click",e);var n=!1;d(t,"touchstart",function(t){n=!0}),d(t,"touchend",function(t){n&&(e(t),r(t))}),d(t,"touchcancel touchleave touchmove",function(t){n=!1})}function l(t,e){!t||0===t.length&&t!=window||(t.length?Array.prototype.forEach.call(t,function(t,n){e(t)}):e(t))}function c(t,e,n,i){d(t,e,function(i){n(i),u(t,e,n)},i)}function d(t,e,n,i){l(t,function(t){var o=e.split(" ");for(var r in o)t.addEventListener(o[r],n,i)})}function u(t,e,n){l(t,function(t){var i=e.split(" ");for(var o in i)t.removeEventListener(i[o],n)})}function a(t,e){return t?t.getAttribute(e):void 0}function h(t,e,n){l(t,function(t){t.setAttribute(e,n)})}function f(t){void 0===t&&(t={});var e={};for(var n in L)e[n]=void 0!==t[n]?t[n]:L[n];return e}function p(t,e){l(t,function(t){if(t.classList){var n=e.split(" ");for(var i in n)t.classList.add(n[i])}else t.className+=" "+e})}function v(t,e){l(t,function(t){if(t.classList){var n=e.split(" ");for(var i in n)t.classList.remove(n[i])}else t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")})}function y(t,e,n,i){n&&c(t,T,n),c(t,T,function(n){v(t,e),i&&i(n)}),p(t,e)}function E(t,e){return t&&e?x(t,e)?t:E(t.parentNode,e):null}function x(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}function g(t){var e=t.querySelector(".todo-text");return{todo_id:a(t,"todo-id"),done:"true"===a(t,"done"),text:e.innerHTML}}function b(t){return void 0===t||""===e(t)||t.length===m()}function k(t){return void 0===t||""===e(t)||m()<=0}function w(t){return t?t.altKey||t.metaKey||t.shiftKey||t.ctrlKey:!1}function m(){if(window.getSelection&&window.getSelection().getRangeAt){for(var t=window.getSelection().getRangeAt(0),e=window.getSelection(),n=0,i=e.anchorNode.parentNode.childNodes,o=0;o<i.length&&i[o]!=e.anchorNode;o++)i[o].outerHTML?n+=i[o].outerHTML.length:3==i[o].nodeType&&(n+=i[o].textContent.length);return t.startOffset+n}return-1}var T="webkitAnimationEnd mozAnimationEnd msAnimationEnd oAnimationEnd animationend",S="ontouchstart"in document.documentElement,L={iconChecked:'<span class="fa fa-check-square-o"></span>',iconUnchecked:'<span class="fa fa-square-o"></span>',iconDelete:'<span class="fa fa-trash-o"></span>',iconInput:'<span class="fa fa-chevron-right"></span>',onDelete:null,onInsert:null,onDone:null,onUpdate:null,showDeleteButton:!1,insertOnBlur:!0,placeholder:"Write here and press enter",guidFunction:t},C=function(t,e,n){if(this.container=t,this.opt=f(n),this.insertEl=i("div.todo-insert",null,this.container),i("div.todo-input-icon",null,this.insertEl,this.opt.iconInput),this.insertTextEl=i("div.todo-text",{contenteditable:!0,spellcheck:!1,placeholder:this.opt.placeholder},this.insertEl),this.listEl=i("div.todo-list",null,this.container),e)for(var o in e)this.insertWithId(e[o],null,!1);d(this.insertTextEl,"keydown",this.insertKeydownEvent.bind(this)),d(this.insertTextEl,"blur",this.insertBlurEvent.bind(this))};C.prototype.insert=function(t){void 0===t.todo_id?this.opt.guidFunction(t,this.insertWithId.bind(this),!0):this.insertWithId(t,null,!0)},C.prototype.insertWithId=function(t,e,n){e&&(t.todo_id=e);var o=i("div.todo",{done:t.done,"todo-id":t.todo_id,"data-original-text":t.text}),r=i("div.todo-checker",null,o,t.done?this.opt.iconChecked:this.opt.iconUnchecked),l=i("div.todo-text",{contenteditable:!0,spellcheck:!1},o,t.text);if(this.opt.showDeleteButton){var c=i("div.todo-delete",null,o,this.opt.iconDelete);s(c,this.deleteEvent.bind(this))}s(r,this.checkEvent.bind(this)),d(l,"blur",this.updateEvent.bind(this)),d(l,"keydown",this.todoKeydownEvent.bind(this)),this.listEl.insertBefore(o,this.listEl.firstChild),n&&(this.opt.onInsert&&this.opt.onInsert(o,t),y(o,"checklist-flipInX"))},C.prototype["delete"]=function(t){var e=this.listEl.querySelector('[todo-id="'+t.todo_id+'"]');if(e){var n=this;y(e,"checklist-flipOutX",null,function(i){e.nextSibling?e.nextSibling.querySelector(".todo-text").focus():e.previousSibling?e.previousSibling.querySelector(".todo-text").focus():n.insertTextEl.focus(),o(e),n.opt.onDelete&&n.opt.onDelete(e,t)})}},C.prototype.update=function(t){if(""===e(t.text))return void this["delete"](t);var n=this.listEl.querySelector('[todo-id="'+t.todo_id+'"]');if(n&&(a(n,"done")!=t.done.toString()||a(n,"data-original-text")!=t.text)){var i=n.querySelector(".todo-checker");h(n,"done",t.done),h(n,"data-original-text",t.text),n.querySelector(".todo-text").innerHTML=t.text,i.innerHTML=t.done?this.opt.iconChecked:this.opt.iconUnchecked,y(n,"checklist-pulse"),this.opt.onUpdate&&this.opt.onUpdate(n,t)}},C.prototype.todoKeydownEvent=function(t){var e=E(t.srcElement,"todo"),n=g(e);t.shiftKey||13!=t.keyCode?t.metaKey&&8==t.keyCode||46==t.keyCode&&t.shiftKey?(this["delete"](n),r(t)):w(t)||!k(n.text)&&!b(n.text)||38!=t.keyCode?w(t)||!k(n.text)&&!b(n.text)||40!=t.keyCode||e.nextSibling&&(e.nextSibling.querySelector(".todo-text").focus(),r(t)):e.previousSibling?(e.previousSibling.querySelector(".todo-text").focus(),r(t)):(this.insertTextEl.focus(),r(t)):(n.done=!n.done,this.update(n),r(t))},C.prototype.insertBlurEvent=function(t){var n=e(this.insertTextEl.innerHTML);if(""===n||null===n)this.insertTextEl.innerHTML="";else if(this.opt.insertOnBlur){var i={text:this.insertTextEl.innerHTML,done:!1};this.insert(i),this.insertTextEl.innerHTML="",r(t)}},C.prototype.insertKeydownEvent=function(t){var n=this.insertTextEl.innerHTML,i=e(n);if(t.shiftKey||13!=t.keyCode||""===i)""===i&&40==t.keyCode&&(this.insertTextEl.innerHTML="",this.listEl.firstChild&&this.listEl.firstChild.querySelector(".todo-text").focus(),r(t));else{var o={text:n,done:!1};this.insert(o),this.insertTextEl.innerHTML="",r(t)}},C.prototype.checkEvent=function(t){var e=E(t.srcElement,"todo"),n=g(e);n.done=!n.done,this.update(n)},C.prototype.updateEvent=function(t){var e=E(t.srcElement,"todo");this.update(g(e))},C.prototype.deleteEvent=function(t){var e=E(t.srcElement,"todo");this["delete"](g(e)),r(t)};var M=n(C,function(t,e,n){C.call(this,t,e,n)});this.Checklist=function(t,e,n){var i=new M(t,e,n);return i},this.Checklist.globals=L}).call(this);